<script>

        
    const images = [
        'skeleton garlic bread meme dope ace.webp',
 
    ];

    const categories = {
            'memes': 'meme',
            'photography': 'gif',
            'art': 'art',
            'wallpapers': 'photo',
            'chribs-picks': 'shitpost'
        };

        document.querySelectorAll('.video-box video').forEach(video => {
        video.style.width = '100%';
        video.style.height = 'auto'; 
        });

        function extractTags(filename) {
            const nameWithoutExt = filename.substring(0, filename.lastIndexOf('.')) || filename;
            return nameWithoutExt.toLowerCase().split(' ');
        }

        function getLatestImagesByTag(tag, limit = 3) {
            const taggedImages = images.filter(img => {
                const tags = extractTags(img);
                return tags.includes(tag);
            });

            return taggedImages.slice(-limit).reverse();
        }


        function populateCategories() {
    for (const [categoryId, tag] of Object.entries(categories)) {
        const imageContainer = document.getElementById(`${categoryId}-images`);
        const latestMedia = getLatestImagesByTag(tag, 3);
        
        if (latestMedia.length === 0) {
            imageContainer.innerHTML = '<p>Images coming soon.</p>';
            continue;
        }

        latestMedia.forEach(media => {
            if (isVideo(media)) {
                const videoElement = document.createElement('video');
    videoElement.src = `https://chrisisediting.github.io/chribswebsite/Media/${encodeURIComponent(media)}`;
    videoElement.preload = 'metadata';
    videoElement.crossOrigin = 'anonymous'; // CORS
    videoElement.muted = true; 
    videoElement.playsInline = true;

                

                const thumbnailImg = document.createElement('img');
                thumbnailImg.alt = media;
                thumbnailImg.ondblclick = () => openOverlay(`https://chrisisediting.github.io/chribswebsite/Media/${encodeURIComponent(media)}`);
                
                videoElement.addEventListener('loadeddata', () => {
                    try {
                        videoElement.currentTime = 0.1;
                        const canvas = document.createElement('canvas');
                        canvas.width = videoElement.videoWidth;
                        canvas.height = videoElement.videoHeight;
                        
                        const context = canvas.getContext('2d');
                        context.drawImage(videoElement, 0, 0, canvas.width, canvas.height);
                        
                        thumbnailImg.src = canvas.toDataURL('image/jpeg', 0.5);
                    } catch (e) {
                        console.error('Thumbnail generation failed:', e);
                    }
                    imageContainer.appendChild(thumbnailImg);
                });
            } else {
                const imgElement = document.createElement('img');
                imgElement.src = `https://chrisisediting.github.io/chribswebsite/Media/${encodeURIComponent(media)}`;
                imgElement.alt = media;
                imgElement.loading = 'lazy';
                imgElement.ondblclick = () => openOverlay(`https://chrisisediting.github.io/chribswebsite/Media/${encodeURIComponent(media)}`);
                imageContainer.appendChild(imgElement);
            }
        });
    }
}


function searchImages() {
    const query = document.getElementById('searchInput').value.toLowerCase().trim();
    const resultsContainer = document.getElementById('results');
    const categoriesContainer = document.getElementById('categories');
    const latestImagesText = document.querySelector('p[style*="color: #ff6969"]');
    const message = document.getElementById('message');
    const loadingOverlay = document.getElementById('loading');

    resultsContainer.innerHTML = '';
    message.style.display = 'none';
    loadingOverlay.style.display = 'flex';

    const isMobile = window.innerWidth <= 700;

    if (query !== '') {
        categoriesContainer.style.display = 'none';
        latestImagesText.style.display = 'none';
    } else {
        categoriesContainer.style.display = 'grid';
        latestImagesText.style.display = 'block';
    }

    if (query === '') {
        message.innerText = 'Please enter image Tag/s';
        message.style.display = 'block';
        loadingOverlay.style.display = 'none';
        return;
    }

    let imagesToLoad = 0;
    let imagesLoaded = 0;

    function checkAllImagesLoaded() {
        imagesLoaded++;
        if (imagesLoaded === imagesToLoad) {
            loadingOverlay.style.display = 'none';
        }
    }


    function matchTags(img, searchTags) {
        const tags = extractTags(img);
        return searchTags.every(tag => tags.includes(tag));
    }

    const searchTags = query.split(' ');
    let mediaToShow = [];

    if (query === '/all') {
        mediaToShow = images.slice().reverse();
    } else {
        mediaToShow = images.filter(img => matchTags(img, searchTags)).reverse();
    }

    if (mediaToShow.length === 0) {
        resultsContainer.innerHTML = '<p>No images found! :(</p>';
        loadingOverlay.style.display = 'none';
        return;
    }

    imagesToLoad = mediaToShow.length;
    mediaToShow.forEach(media => {
        const mediaBox = createImageElement(media);
        
        if (isVideo(media)) {
            const thumbnailImg = mediaBox.querySelector('img');
            if (thumbnailImg) {
                const videoElement = document.createElement('video');
                videoElement.src = `https://chrisisediting.github.io/chribswebsite/Media/${encodeURIComponent(media)}`;
                videoElement.preload = 'metadata';
                
                videoElement.addEventListener('loadeddata', checkAllImagesLoaded);
                videoElement.addEventListener('error', checkAllImagesLoaded);
            } else {
                checkAllImagesLoaded(); 
            }
        } else {
            const img = mediaBox.querySelector('img');
            if (img) {
                if (img.complete) {
                    checkAllImagesLoaded();
                } else {
                    img.onload = checkAllImagesLoaded;
                    img.onerror = checkAllImagesLoaded;
                }
            } else {
                checkAllImagesLoaded(); 
            }
        }
        
        resultsContainer.appendChild(mediaBox);
    });

   
    window.onload = () => {
    loadingOverlay.style.display = 'none'; 
};

}

function isVideo(filename) {
    return /\.(mp4|webm|ogg)$/i.test(filename);
}





function showFormatOverlay(videoFile) {
    const formatOverlay = document.querySelector('.format-overlay');
    
    const extension = videoFile.split('.').pop().toUpperCase();
    if (['MP4', 'GIF', 'WEBM', 'WEBP'].includes(extension)) {
        formatOverlay.textContent = extension; 
        formatOverlay.style.display = 'block'; 
    } else {
        formatOverlay.style.display = 'none'; 
    }
}



function searchCategory(category) {
    const resultsContainer = document.getElementById('results');
    resultsContainer.innerHTML = '';

    const latestMedia = getLatestImagesByTag(categories[category]);
    
    if (latestMedia.length === 0) {
        resultsContainer.innerHTML = '<p>No media in this category :(</p>';
        return;
    }

    latestMedia.forEach(media => {
        const mediaBox = createImageElement(media);
        resultsContainer.appendChild(mediaBox);
    });
}



        function isVideo(filename) {
        return /\.(mp4|webm|ogg)$/i.test(filename);
        }

        function openOverlay(mediaSrc) {
    const overlay = document.getElementById('imageOverlay');
    const enlargedImage = document.getElementById('enlargedImage');
    const enlargedVideo = document.getElementById('enlargedVideo');

    let closeButton = document.createElement('button');
    closeButton.innerText = 'X';
    closeButton.className = 'close-button';
    
    overlay.appendChild(closeButton);

    if (isVideo(mediaSrc)) {
        enlargedVideo.src = mediaSrc;
        enlargedVideo.style.display = 'block';
        enlargedImage.style.display = 'none';
        enlargedVideo.controls = true;
    } else {
        enlargedImage.src = mediaSrc;
        enlargedImage.style.display = 'block';
        enlargedVideo.style.display = 'none';
    }

    overlay.style.display = 'flex';
    closeButton.onclick = closeOverlay;
}


function closeOverlay() {
    const overlay = document.getElementById('imageOverlay');
    const enlargedVideo = document.getElementById('enlargedVideo');
    const closeButton = overlay.querySelector('button');

    overlay.style.display = 'none';

    if (enlargedVideo) {
        enlargedVideo.pause();
        enlargedVideo.currentTime = 0;
    }


    if (closeButton) {
        overlay.removeChild(closeButton);
    }
}




        window.onload = function() {
    populateCategories();
    document.querySelector('.search-input').addEventListener('keydown', function(event) {
        if (event.key === 'Enter') {
            event.preventDefault();
            searchImages();
        }
    });
};

window.addEventListener('resize', function() {
    const query = document.getElementById('searchInput').value.toLowerCase().trim();
    const isMobile = window.innerWidth <= 700;
    const categoriesContainer = document.getElementById('categories');
    const latestImagesText = document.querySelector('p[style*="color: #ff6969"]');

    if (query !== '' && isMobile) {
        categoriesContainer.style.display = 'none';
        latestImagesText.style.display = 'none';
    } else if (!isMobile) {
        categoriesContainer.style.display = 'grid';
        latestImagesText.style.display = 'block';
    }
});

function createImageTypeOverlay(img) {
    const overlay = document.createElement('div');
    overlay.className = 'image-type-overlay';
    const extension = img.split('.').pop().toUpperCase();
    overlay.textContent = extension; 
    overlay.style.position = 'absolute'; 
    overlay.style.bottom = '5px'; 
    overlay.style.right = '5px'; 
    overlay.style.backgroundColor = 'rgba(0, 0, 0, 0.5)';
    overlay.style.color = '#fff';
    overlay.style.padding = '5px'; 
    overlay.style.borderRadius = '5px'; 

    return overlay;
}

function createImageElement(img) {
    const imgBox = document.createElement('div');
    imgBox.className = 'image-box';
    imgBox.style.position = 'relative';
    imgBox.style.cursor = 'pointer'; 

    if (isVideo(img)) {
        const videoElement = document.createElement('video');
        videoElement.src = `https://chrisisediting.github.io/chribswebsite/Media/${encodeURIComponent(img)}`;
        videoElement.preload = 'metadata';
        videoElement.crossOrigin = 'anonymous'; // CORS
        videoElement.load();

        const thumbnailImg = document.createElement('img');
        thumbnailImg.alt = img;

        imgBox.onclick = () => openOverlay(`https://chrisisediting.github.io/chribswebsite/Media/${encodeURIComponent(img)}`);

        videoElement.addEventListener('loadeddata', () => {
            const canvas = document.createElement('canvas');
            const scaleFactor = Math.min(160 / videoElement.videoWidth, 90 / videoElement.videoHeight);
            canvas.width = videoElement.videoWidth * scaleFactor;
            canvas.height = videoElement.videoHeight * scaleFactor;

            const context = canvas.getContext('2d');
            context.drawImage(videoElement, 0, 0, canvas.width, canvas.height);
            thumbnailImg.src = canvas.toDataURL();
            imgBox.appendChild(thumbnailImg);
            imgBox.appendChild(createImageTypeOverlay(img));
        });

        videoElement.load(); 
    } else {
        const imgElement = document.createElement('img');
        imgElement.src = `https://chrisisediting.github.io/chribswebsite/Media/${encodeURIComponent(img)}`;
        imgElement.alt = img;
        imgElement.crossOrigin = 'anonymous';
        imgBox.onclick = () => openOverlay(`https://chrisisediting.github.io/chribswebsite/Media/${encodeURIComponent(img)}`);

        imgBox.appendChild(imgElement);
        imgBox.appendChild(createImageTypeOverlay(img));
    }

    return imgBox;
}
</script>